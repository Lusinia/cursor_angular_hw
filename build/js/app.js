"use strict";var shopApp=angular.module("shopApp",["ngRoute","ngAnimate"]);shopApp.config(["$routeProvider","$locationProvider",function(t,r){t.when("/",{templateUrl:"../partials/home.html",controller:"mainController"}).when("/add",{templateUrl:"../partials/add.html",controller:"addProduct"}).when("/orders",{templateUrl:"../partials/orders.html",controller:"ShowOrders"}).when("/product/:id",{templateUrl:"../partials/product.html",controller:"ShowProduct"}).otherwise({redirectTo:"/orders"}),r.html5Mode(!0)}]),angular.module("shopApp").run(["$templateCache",function(t){t.put("../partials/add.html",'<div class={{pageStyle}}><h1>Добро пожаловать</h1><h2 class=text-primary>Добавить книгу в список</h2><form name=form class=css-form novalidate><div class=form-group><label for=name>Title <input type=text id=name name=name class=form-control data-ng-model=newProduct.title required ng-minlength=2></label><p ng-show=form.name.$error.minlength class=help-block>Название книги слишком короткое.</p></div><div class=form-group><label for=img>Image url <input type=text id=img class=form-control name=img data-ng-model=newProduct.img required ng-pattern="/^(https?:\\/\\/)?([\\da-z\\.-]+)\\.([a-z\\.]{2,6})([\\/\\w \\.-]*)*\\/?$/"></label><p ng-show=form.img.$error.pattern class=help-block>Укажите изображение книги.</p></div><div class=form-group><label for=genre>Genre <input type=text id=genre class=form-control name=genre data-ng-model=newProduct.genre required ng-minlength=2></label><p ng-show=form.genre.$error.minlength class=help-block>Какого жанра эта книга.</p></div><div class=form-group><label for=cost>Cost <input type=text id=cost class=form-control name=cost data-ng-model=newProduct.cost required ng-pattern="/^[0-9]{1,}$/"></label><p ng-show=form.cost.$error.pattern class=help-block>Введите стоимость книги.</p></div><div class=form-group><label for=desc>Description <textarea id=desc name=desc class=form-control data-ng-model=newProduct.desc required ng-minlength=2></textarea></label><p ng-show=form.desc.$error.minlength class=help-block>Укажите описание книги.</p></div><div class=buttonWrapper><button type=submit data-ng-click=addProduct() class="btn btn-success" ng-disabled=form.$invalid>Добавить</button> <a href="/" class="btn btn-primary">На главную</a></div></form></div>'),t.put("../partials/home.html",'<div class="{{ pageStyle }}"><h1>Книжный магазин</h1><h2>Книги на любой вкус</h2><div class=buttons><a href=/add class="btn btn-primary btn-lg">Добавить книгу</a> <a href=/orders data-ng-click=setOrdersNumber() class="btn btn-primary btn-lg">Мои заказы <span class="glyphicon glyphicon-flash" aria-hidden=true></span> {{orders.length}}</a></div><ul class=list><li data-ng-repeat=\'prod in products | filter: prod.title | orderBy: "title"\' data-ng-click=showProduct(prod) ng-animate="\'animate\'" data-ng-model=item><md-card><p class=genre>{{ prod.genre }}</p><a href="/product/{{ prod.id }}"><h3>{{ prod.title }}</h3><img src="{{ prod.img }}" width=100 class=md-card-image alt="image caption"><br></a><p class=desc>{{ prod.description.substring(0, 50) }} ...</p><div class=cost>{{prod.cost}} $</div></md-card></li></ul></div>'),t.put("../partials/orders.html",'<div class={{pageStyle}}><h1>Книжная лавочка</h1><h2>Твои заказы</h2><ul class=orders-list><li data-ng-repeat=\'order in orders | filter: order.id | orderBy: "id"\'>№ {{ order.id }}. <span>{{ order.title }}</span> - {{ order.quantity }} pc ({{ order.cost*order.quantity}} $)<button class="btn btn-danger" data-ng-click=removeOrder($index)>Удалить</button></li></ul><div class=sum><span>Общая сумма:</span> <span class=sumInfo>{{ sum }} $</span></div><a href="/" class="btn btn-primary btn-lg">На главную</a></div>'),t.put("../partials/product.html",'<div class={{pageStyle}}><md-toolbar class=md-warn><a href=#orders class="btn btn-primary btn-lg buy" data-ng-click=addOrder(item)>Купить всего за $ {{ cost }}</a></md-toolbar><md-content flex layout-padding><h1>{{ title}}</h1><img class=img-responsive src="{{ img }}" alt=img width=300><p class=desc>{{ description }}</p><p><b>Жанр: <span>{{genre}}</span></b></p></md-content><a href=/orders ng-click=deleteProduct() class="btn btn-warning">Удалить книгу</a> <a href="/" class="btn btn-info">На главную</a></div>')}]),shopApp.factory("ordersFactory",function(){var t=[{id:1,title:"Cat in the dark",img:"./img/cat2.jpg",desc:"Its just me",cost:"50",quantity:1}],r={};return r.getOrders=function(){return t},r.addOrder=function(r){if(t.length>0){var e=!1;t.forEach(function(t){r.title===t.title&&(e=!0,t.quantity++)}),e||t.push(r)}},r.defineCostForItems=function(t){var r=0;return t.forEach(function(t){r+=+t.cost}),r},r}),shopApp.factory("productsFactory",["$http","$location",function(t,r){var e=function(){return t.get("http://localhost:8080/")},o=[],n={};return n.getJSON=function(){return e()},n.getProducts=function(){return o},n.setProducts=function(t){o=t},n.addProduct=function(e){t({method:"post",url:"http://localhost:8080/",data:JSON.stringify(e),config:"Content-Type: application/json;"}).then(function(t){console.log(t),r.path("/")},function(t){console.log(t)})},n.deleteProduct=function(r){var e={index:r.index,productId:r.product.id};t.delete("http://localhost:8080/product/"+e.productId,{params:e}).then(function(t){console.log(t)})},n.findProductById=function(t){var r=void 0;return o.forEach(function(e){e.id==t&&(r=e)}),r},n}]),shopApp.controller("ShowOrders",["$scope","$routeParams","productsFactory","ordersFactory",function(t,r,e,o){t.pageStyle="showOrdersStyle",t.orders=[],t.sum=o.defineCostForItems(o.getOrders()),t.item={},t.selected={value:0};t.orders=o.getOrders(),t.removeOrder=function(r){t.orders[r].quantity>1?t.orders[r].quantity-=1:1===t.orders[r].quantity&&t.orders.splice(r,1)}}]),shopApp.controller("ShowProduct",["$scope","$routeParams","productsFactory","ordersFactory",function(t,r,e,o){t.pageStyle="showProductStyle",t.ProductId=r.id;var n=e.findProductById(t.ProductId);t.img=n.img,t.title=n.title,t.genre=n.genre,t.description=n.description,t.cost=n.cost,t.products=e.getProducts(),t.addOrder=function(t){o.addOrder({title:n.title,id:o.getOrders().length+1,cost:n.cost,quantity:1})},t.deleteProduct=function(){var r=t.products.indexOf(n);e.deleteProduct({index:r,product:n})}}]),shopApp.controller("addProduct",["$scope","productsFactory",function(t,r){t.pageStyle="addStyle",t.addProduct=function(){r.addProduct({title:t.newProduct.title,img:t.newProduct.img,description:t.newProduct.desc,genre:t.newProduct.genre,cost:t.newProduct.cost,id:Math.random()})}}]),shopApp.controller("mainController",["$scope","$location","$routeParams","productsFactory","ordersFactory",function(t,r,e,o,n){t.pageStyle="mainPageStyle",t.pageClass="page-style",t.products=[],t.orders=[],t.item={};var a=function(){o.getJSON().then(function(r){var e=[];r.data.forEach(function(t){var r={};r.description=t.description,r.title=t.title,r.img=t.img,r.genre=t.genre,r.cost=t.cost,r.id=t.id,e.push(r)}),o.setProducts(e),t.products=e})};t.products=a(),t.orders=n.getOrders()}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInRlbXBsYXRlcy5qcyIsIm9yZGVycy5qcyIsInByb2R1Y3RzLmpzIiwiU2hvd09yZGVycy5qcyIsIlNob3dQcm9kdWN0LmpzIiwiYWRkUHJvZHVjdC5qcyIsIm1haW5Db250cm9sbGVyLmpzIl0sIm5hbWVzIjpbInNob3BBcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwiaHRtbDVNb2RlIiwicnVuIiwiJHRlbXBsYXRlQ2FjaGUiLCJwdXQiLCJmYWN0b3J5Iiwib3JkZXJzIiwiaWQiLCJ0aXRsZSIsImltZyIsImRlc2MiLCJjb3N0IiwicXVhbnRpdHkiLCJnZXRPcmRlcnMiLCJhZGRPcmRlciIsIml0ZW0iLCJsZW5ndGgiLCJpc0NvaW5jaWRlbmNlIiwiZm9yRWFjaCIsIm9yZGVyIiwicHVzaCIsImRlZmluZUNvc3RGb3JJdGVtcyIsInN1bSIsIiRodHRwIiwiJGxvY2F0aW9uIiwicmVjaWV2ZURhdGEiLCJnZXQiLCJwcm9kdWN0cyIsImdldEpTT04iLCJnZXRQcm9kdWN0cyIsInNldFByb2R1Y3RzIiwiZGF0YSIsImFkZFByb2R1Y3QiLCJtZXRob2QiLCJ1cmwiLCJKU09OIiwic3RyaW5naWZ5IiwidGhlbiIsInJlc3BvbnNlIiwiY29uc29sZSIsImxvZyIsInBhdGgiLCJkZWxldGVQcm9kdWN0IiwicHJvZHVjdEluZm8iLCJpbmRleCIsInByb2R1Y3RJZCIsInByb2R1Y3QiLCJkZWxldGUiLCJwYXJhbXMiLCJmaW5kUHJvZHVjdEJ5SWQiLCJmb3VuZCIsIiRzY29wZSIsIiRyb3V0ZVBhcmFtcyIsInByb2R1Y3RzRmFjdG9yeSIsIm9yZGVyc0ZhY3RvcnkiLCJwYWdlU3R5bGUiLCJzZWxlY3RlZCIsInZhbHVlIiwicmVtb3ZlT3JkZXIiLCJzcGxpY2UiLCJQcm9kdWN0SWQiLCJjdXJyZW50UHJvZHVjdCIsImdlbnJlIiwiZGVzY3JpcHRpb24iLCJpbmRleE9mIiwibmV3UHJvZHVjdCIsIk1hdGgiLCJyYW5kb20iLCJwYWdlQ2xhc3MiLCJjcmVhdGVMaXN0IiwiaXRlbXMiLCJsaXN0Iiwia2V5IiwibGlzdEl0ZW0iXSwibWFwcGluZ3MiOiJBQUFBLGFBR0EsSUFBQUEsUUFBQUMsUUFBQUMsT0FBQSxXQUFBLFVBQUEsY0FLQUYsUUFBQUcsUUFBQSxpQkFBQSxvQkFBQSxTQUFBQyxFQUFBQyxHQUVBRCxFQUdBRSxLQUFBLEtBQ0FDLFlBQUEsd0JBQ0FDLFdBQUEsbUJBSUFGLEtBQUEsUUFDQUMsWUFBQSx1QkFDQUMsV0FBQSxlQUlBRixLQUFBLFdBQ0FDLFlBQUEsMEJBQ0FDLFdBQUEsZUFJQUYsS0FBQSxnQkFDQUMsWUFBQSwyQkFDQUMsV0FBQSxnQkFDQUMsV0FBQUMsV0FBQSxZQUNBTCxFQUFBTSxXQUFBLE1DbkNBVixRQUFBQyxPQUFBLFdBQUFVLEtBQUEsaUJBQUEsU0FBQUMsR0FBQUEsRUFBQUMsSUFBQSx1QkFBQSx3cURBQ0FELEVBQUFDLElBQUEsd0JBQUEsOHpCQUNBRCxFQUFBQyxJQUFBLDBCQUFBLHFnQkFDQUQsRUFBQUMsSUFBQSwyQkFBQSx3Z0JDQUFkLFFBQUFlLFFBQUEsZ0JBQUEsV0FDQSxJQUFBQyxJQUNBQyxHQUFBLEVBQ0FDLE1BQUEsa0JBQ0FDLElBQUEsaUJBQ0FDLEtBQUEsY0FDQUMsS0FBQSxLQUNBQyxTQUFBLElBRUFQLEtBMkJBLE9BMUJBQSxFQUFBUSxVQUFBLFdBQ0EsT0FBQVAsR0FHQUQsRUFBQVMsU0FBQSxTQUFBQyxHQUVBLEdBQUFULEVBQUFVLE9BQUEsRUFBQSxDQUNBLElBQUFDLEdBQUEsRUFDQVgsRUFBQVksUUFBQSxTQUFBQyxHQUNBSixFQUFBUCxRQUFBVyxFQUFBWCxRQUNBUyxHQUFBLEVBQ0FFLEVBQUFQLGNBR0FLLEdBQ0FYLEVBQUFjLEtBQUFMLEtBSUFWLEVBQUFnQixtQkFBQSxTQUFBZixHQUNBLElBQUFn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QUFBSCxNQUNBbkQsS0FBQXdDLEVBQUFjLFdBQUF0RCxLQUNBSixHQUFBMkQsS0FBQUMsZUNQQTdFLFFBQUFRLFdBQUEsa0JBQUEsU0FBQSxZQUFBLGVBQUEsa0JBQUEsZ0JBQUEsU0FBQXFELEVBQUEzQixFQUFBNEIsRUFBQUMsRUFBQUMsR0FDQUgsRUFBQUksVUFBQSxnQkFDQUosRUFBQWlCLFVBQUEsYUFDQWpCLEVBQUF4QixZQUNBd0IsRUFBQTdDLFVBQ0E2QyxFQUFBcEMsUUFFQSxJQUFBc0QsRUFBQSxXQUNBaEIsRUFBQXpCLFVBQUFTLEtBQUEsU0FBQWlDLEdBQ0EsSUFBQUMsS0FDQUQsRUFBQXZDLEtBQUFiLFFBQUEsU0FBQXNELEdBQ0EsSUFBQUMsS0FDQUEsRUFBQVYsWUFBQVMsRUFBQVQsWUFDQVUsRUFBQWpFLE1BQUFnRSxFQUFBaEUsTUFDQWlFLEVBQUFoRSxJQUFBK0QsRUFBQS9ELElBQ0FnRSxFQUFBWCxNQUFBVSxFQUFBVixNQUNBVyxFQUFBOUQsS0FBQTZELEVBQUE3RCxLQUNBOEQsRUFBQWxFLEdBQUFpRSxFQUFBakUsR0FDQWdFLEVBQUFuRCxLQUFBcUQsS0FFQXBCLEVBQUF2QixZQUFBeUMsR0FDQXBCLEVBQUF4QixTQUFBNEMsS0FLQXBCLEVBQUF4QixTQUFBMEMsSUFDQWxCLEVBQUE3QyxPQUFBZ0QsRUFBQXpDIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG4vLyBkZWZpbmUgb3VyIGFwcGxpY2F0aW9uIGFuZCBwdWxsIGluIG5nUm91dGUgYW5kIG5nQW5pbWF0ZVxudmFyIHNob3BBcHAgPSBhbmd1bGFyLm1vZHVsZShcInNob3BBcHBcIiwgW1wibmdSb3V0ZVwiLCBcIm5nQW5pbWF0ZVwiXSk7XG4vL1xuLy8gUk9VVElORyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gc2V0IG91ciByb3V0aW5nIGZvciB0aGlzIGFwcGxpY2F0aW9uXG4vLyBlYWNoIHJvdXRlIHdpbGwgcHVsbCBpbiBhIGRpZmZlcmVudCBjb250cm9sbGVyXG5zaG9wQXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJywgZnVuY3Rpb24gKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikge1xuXG4gICAgJHJvdXRlUHJvdmlkZXJcblxuICAgIC8vIGhvbWUgcGFnZVxuICAgIC53aGVuKFwiL1wiLCB7XG4gICAgICAgIHRlbXBsYXRlVXJsOiBcIi4uL3BhcnRpYWxzL2hvbWUuaHRtbFwiLFxuICAgICAgICBjb250cm9sbGVyOiBcIm1haW5Db250cm9sbGVyXCJcbiAgICB9KVxuXG4gICAgLy8gYWRkIHBhZ2VcbiAgICAud2hlbihcIi9hZGRcIiwge1xuICAgICAgICB0ZW1wbGF0ZVVybDogXCIuLi9wYXJ0aWFscy9hZGQuaHRtbFwiLFxuICAgICAgICBjb250cm9sbGVyOiBcImFkZFByb2R1Y3RcIlxuICAgIH0pXG5cbiAgICAvLyBvcmRlcnMgcGFnZVxuICAgIC53aGVuKFwiL29yZGVyc1wiLCB7XG4gICAgICAgIHRlbXBsYXRlVXJsOiBcIi4uL3BhcnRpYWxzL29yZGVycy5odG1sXCIsXG4gICAgICAgIGNvbnRyb2xsZXI6IFwiU2hvd09yZGVyc1wiXG4gICAgfSlcblxuICAgIC8vIHByb2R1Y3QgcGFnZVxuICAgIC53aGVuKFwiL3Byb2R1Y3QvOmlkXCIsIHtcbiAgICAgICAgdGVtcGxhdGVVcmw6IFwiLi4vcGFydGlhbHMvcHJvZHVjdC5odG1sXCIsXG4gICAgICAgIGNvbnRyb2xsZXI6IFwiU2hvd1Byb2R1Y3RcIlxuICAgIH0pLm90aGVyd2lzZSh7IHJlZGlyZWN0VG86IFwiL29yZGVyc1wiIH0pO1xuICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnc2hvcEFwcCcpLnJ1bihbJyR0ZW1wbGF0ZUNhY2hlJywgZnVuY3Rpb24oJHRlbXBsYXRlQ2FjaGUpIHskdGVtcGxhdGVDYWNoZS5wdXQoJy4uL3BhcnRpYWxzL2FkZC5odG1sJywnPGRpdiBjbGFzcz17e3BhZ2VTdHlsZX19PjxoMT5cXHUwNDE0XFx1MDQzRVxcdTA0MzFcXHUwNDQwXFx1MDQzRSBcXHUwNDNGXFx1MDQzRVxcdTA0MzZcXHUwNDMwXFx1MDQzQlxcdTA0M0VcXHUwNDMyXFx1MDQzMFxcdTA0NDJcXHUwNDRDPC9oMT48aDIgY2xhc3M9dGV4dC1wcmltYXJ5PlxcdTA0MTRcXHUwNDNFXFx1MDQzMVxcdTA0MzBcXHUwNDMyXFx1MDQzOFxcdTA0NDJcXHUwNDRDIFxcdTA0M0FcXHUwNDNEXFx1MDQzOFxcdTA0MzNcXHUwNDQzIFxcdTA0MzIgXFx1MDQ0MVxcdTA0M0ZcXHUwNDM4XFx1MDQ0MVxcdTA0M0VcXHUwNDNBPC9oMj48Zm9ybSBuYW1lPWZvcm0gY2xhc3M9Y3NzLWZvcm0gbm92YWxpZGF0ZT48ZGl2IGNsYXNzPWZvcm0tZ3JvdXA+PGxhYmVsIGZvcj1uYW1lPlRpdGxlIDxpbnB1dCB0eXBlPXRleHQgaWQ9bmFtZSBuYW1lPW5hbWUgY2xhc3M9Zm9ybS1jb250cm9sIGRhdGEtbmctbW9kZWw9bmV3UHJvZHVjdC50aXRsZSByZXF1aXJlZCBuZy1taW5sZW5ndGg9Mj48L2xhYmVsPjxwIG5nLXNob3c9Zm9ybS5uYW1lLiRlcnJvci5taW5sZW5ndGggY2xhc3M9aGVscC1ibG9jaz5cXHUwNDFEXFx1MDQzMFxcdTA0MzdcXHUwNDMyXFx1MDQzMFxcdTA0M0RcXHUwNDM4XFx1MDQzNSBcXHUwNDNBXFx1MDQzRFxcdTA0MzhcXHUwNDMzXFx1MDQzOCBcXHUwNDQxXFx1MDQzQlxcdTA0MzhcXHUwNDQ4XFx1MDQzQVxcdTA0M0VcXHUwNDNDIFxcdTA0M0FcXHUwNDNFXFx1MDQ0MFxcdTA0M0VcXHUwNDQyXFx1MDQzQVxcdTA0M0VcXHUwNDM1LjwvcD48L2Rpdj48ZGl2IGNsYXNzPWZvcm0tZ3JvdXA+PGxhYmVsIGZvcj1pbWc+SW1hZ2UgdXJsIDxpbnB1dCB0eXBlPXRleHQgaWQ9aW1nIGNsYXNzPWZvcm0tY29udHJvbCBuYW1lPWltZyBkYXRhLW5nLW1vZGVsPW5ld1Byb2R1Y3QuaW1nIHJlcXVpcmVkIG5nLXBhdHRlcm49XCIvXihodHRwcz86XFxcXC9cXFxcLyk/KFtcXFxcZGEtelxcXFwuLV0rKVxcXFwuKFthLXpcXFxcLl17Miw2fSkoW1xcXFwvXFxcXHcgXFxcXC4tXSopKlxcXFwvPyQvXCI+PC9sYWJlbD48cCBuZy1zaG93PWZvcm0uaW1nLiRlcnJvci5wYXR0ZXJuIGNsYXNzPWhlbHAtYmxvY2s+XFx1MDQyM1xcdTA0M0FcXHUwNDMwXFx1MDQzNlxcdTA0MzhcXHUwNDQyXFx1MDQzNSBcXHUwNDM4XFx1MDQzN1xcdTA0M0VcXHUwNDMxXFx1MDQ0MFxcdTA0MzBcXHUwNDM2XFx1MDQzNVxcdTA0M0RcXHUwNDM4XFx1MDQzNSBcXHUwNDNBXFx1MDQzRFxcdTA0MzhcXHUwNDMzXFx1MDQzOC48L3A+PC9kaXY+PGRpdiBjbGFzcz1mb3JtLWdyb3VwPjxsYWJlbCBmb3I9Z2VucmU+R2VucmUgPGlucHV0IHR5cGU9dGV4dCBpZD1nZW5yZSBjbGFzcz1mb3JtLWNvbnRyb2wgbmFtZT1nZW5yZSBkYXRhLW5nLW1vZGVsPW5ld1Byb2R1Y3QuZ2VucmUgcmVxdWlyZWQgbmctbWlubGVuZ3RoPTI+PC9sYWJlbD48cCBuZy1zaG93PWZvcm0uZ2VucmUuJGVycm9yLm1pbmxlbmd0aCBjbGFzcz1oZWxwLWJsb2NrPlxcdTA0MUFcXHUwNDMwXFx1MDQzQVxcdTA0M0VcXHUwNDMzXFx1MDQzRSBcXHUwNDM2XFx1MDQzMFxcdTA0M0RcXHUwNDQwXFx1MDQzMCBcXHUwNDREXFx1MDQ0MlxcdTA0MzAgXFx1MDQzQVxcdTA0M0RcXHUwNDM4XFx1MDQzM1xcdTA0MzAuPC9wPjwvZGl2PjxkaXYgY2xhc3M9Zm9ybS1ncm91cD48bGFiZWwgZm9yPWNvc3Q+Q29zdCA8aW5wdXQgdHlwZT10ZXh0IGlkPWNvc3QgY2xhc3M9Zm9ybS1jb250cm9sIG5hbWU9Y29zdCBkYXRhLW5nLW1vZGVsPW5ld1Byb2R1Y3QuY29zdCByZXF1aXJlZCBuZy1wYXR0ZXJuPVwiL15bMC05XXsxLH0kL1wiPjwvbGFiZWw+PHAgbmctc2hvdz1mb3JtLmNvc3QuJGVycm9yLnBhdHRlcm4gY2xhc3M9aGVscC1ibG9jaz5cXHUwNDEyXFx1MDQzMlxcdTA0MzVcXHUwNDM0XFx1MDQzOFxcdTA0NDJcXHUwNDM1IFxcdTA0NDFcXHUwNDQyXFx1MDQzRVxcdTA0MzhcXHUwNDNDXFx1MDQzRVxcdTA0NDFcXHUwNDQyXFx1MDQ0QyBcXHUwNDNBXFx1MDQzRFxcdTA0MzhcXHUwNDMzXFx1MDQzOC48L3A+PC9kaXY+PGRpdiBjbGFzcz1mb3JtLWdyb3VwPjxsYWJlbCBmb3I9ZGVzYz5EZXNjcmlwdGlvbiA8dGV4dGFyZWEgaWQ9ZGVzYyBuYW1lPWRlc2MgY2xhc3M9Zm9ybS1jb250cm9sIGRhdGEtbmctbW9kZWw9bmV3UHJvZHVjdC5kZXNjIHJlcXVpcmVkIG5nLW1pbmxlbmd0aD0yPjwvdGV4dGFyZWE+PC9sYWJlbD48cCBuZy1zaG93PWZvcm0uZGVzYy4kZXJyb3IubWlubGVuZ3RoIGNsYXNzPWhlbHAtYmxvY2s+XFx1MDQyM1xcdTA0M0FcXHUwNDMwXFx1MDQzNlxcdTA0MzhcXHUwNDQyXFx1MDQzNSBcXHUwNDNFXFx1MDQzRlxcdTA0MzhcXHUwNDQxXFx1MDQzMFxcdTA0M0RcXHUwNDM4XFx1MDQzNSBcXHUwNDNBXFx1MDQzRFxcdTA0MzhcXHUwNDMzXFx1MDQzOC48L3A+PC9kaXY+PGRpdiBjbGFzcz1idXR0b25XcmFwcGVyPjxidXR0b24gdHlwZT1zdWJtaXQgZGF0YS1uZy1jbGljaz1hZGRQcm9kdWN0KCkgY2xhc3M9XCJidG4gYnRuLXN1Y2Nlc3NcIiBuZy1kaXNhYmxlZD1mb3JtLiRpbnZhbGlkPlxcdTA0MTRcXHUwNDNFXFx1MDQzMVxcdTA0MzBcXHUwNDMyXFx1MDQzOFxcdTA0NDJcXHUwNDRDPC9idXR0b24+IDxhIGhyZWY9XCIvXCIgY2xhc3M9XCJidG4gYnRuLXByaW1hcnlcIj5cXHUwNDFEXFx1MDQzMCBcXHUwNDMzXFx1MDQzQlxcdTA0MzBcXHUwNDMyXFx1MDQzRFxcdTA0NDNcXHUwNDRFPC9hPjwvZGl2PjwvZm9ybT48L2Rpdj4nKTtcbiR0ZW1wbGF0ZUNhY2hlLnB1dCgnLi4vcGFydGlhbHMvaG9tZS5odG1sJywnPGRpdiBjbGFzcz1cInt7IHBhZ2VTdHlsZSB9fVwiPjxoMT5cXHUwNDFBXFx1MDQzRFxcdTA0MzhcXHUwNDM2XFx1MDQzRFxcdTA0NEJcXHUwNDM5IFxcdTA0M0NcXHUwNDMwXFx1MDQzM1xcdTA0MzBcXHUwNDM3XFx1MDQzOFxcdTA0M0Q8L2gxPjxoMj5cXHUwNDFBXFx1MDQzRFxcdTA0MzhcXHUwNDMzXFx1MDQzOCBcXHUwNDNEXFx1MDQzMCBcXHUwNDNCXFx1MDQ0RVxcdTA0MzFcXHUwNDNFXFx1MDQzOSBcXHUwNDMyXFx1MDQzQVxcdTA0NDNcXHUwNDQxPC9oMj48ZGl2IGNsYXNzPWJ1dHRvbnM+PGEgaHJlZj0vYWRkIGNsYXNzPVwiYnRuIGJ0bi1wcmltYXJ5IGJ0bi1sZ1wiPlxcdTA0MTRcXHUwNDNFXFx1MDQzMVxcdTA0MzBcXHUwNDMyXFx1MDQzOFxcdTA0NDJcXHUwNDRDIFxcdTA0M0FcXHUwNDNEXFx1MDQzOFxcdTA0MzNcXHUwNDQzPC9hPiA8YSBocmVmPS9vcmRlcnMgZGF0YS1uZy1jbGljaz1zZXRPcmRlcnNOdW1iZXIoKSBjbGFzcz1cImJ0biBidG4tcHJpbWFyeSBidG4tbGdcIj5cXHUwNDFDXFx1MDQzRVxcdTA0MzggXFx1MDQzN1xcdTA0MzBcXHUwNDNBXFx1MDQzMFxcdTA0MzdcXHUwNDRCIDxzcGFuIGNsYXNzPVwiZ2x5cGhpY29uIGdseXBoaWNvbi1mbGFzaFwiIGFyaWEtaGlkZGVuPXRydWU+PC9zcGFuPiB7e29yZGVycy5sZW5ndGh9fTwvYT48L2Rpdj48dWwgY2xhc3M9bGlzdD48bGkgZGF0YS1uZy1yZXBlYXQ9XFwncHJvZCBpbiBwcm9kdWN0cyB8IGZpbHRlcjogcHJvZC50aXRsZSB8IG9yZGVyQnk6IFwidGl0bGVcIlxcJyBkYXRhLW5nLWNsaWNrPXNob3dQcm9kdWN0KHByb2QpIG5nLWFuaW1hdGU9XCJcXCdhbmltYXRlXFwnXCIgZGF0YS1uZy1tb2RlbD1pdGVtPjxtZC1jYXJkPjxwIGNsYXNzPWdlbnJlPnt7IHByb2QuZ2VucmUgfX08L3A+PGEgaHJlZj1cIi9wcm9kdWN0L3t7IHByb2QuaWQgfX1cIj48aDM+e3sgcHJvZC50aXRsZSB9fTwvaDM+PGltZyBzcmM9XCJ7eyBwcm9kLmltZyB9fVwiIHdpZHRoPTEwMCBjbGFzcz1tZC1jYXJkLWltYWdlIGFsdD1cImltYWdlIGNhcHRpb25cIj48YnI+PC9hPjxwIGNsYXNzPWRlc2M+e3sgcHJvZC5kZXNjcmlwdGlvbi5zdWJzdHJpbmcoMCwgNTApIH19IC4uLjwvcD48ZGl2IGNsYXNzPWNvc3Q+e3twcm9kLmNvc3R9fSAkPC9kaXY+PC9tZC1jYXJkPjwvbGk+PC91bD48L2Rpdj4nKTtcbiR0ZW1wbGF0ZUNhY2hlLnB1dCgnLi4vcGFydGlhbHMvb3JkZXJzLmh0bWwnLCc8ZGl2IGNsYXNzPXt7cGFnZVN0eWxlfX0+PGgxPlxcdTA0MUFcXHUwNDNEXFx1MDQzOFxcdTA0MzZcXHUwNDNEXFx1MDQzMFxcdTA0NEYgXFx1MDQzQlxcdTA0MzBcXHUwNDMyXFx1MDQzRVxcdTA0NDdcXHUwNDNBXFx1MDQzMDwvaDE+PGgyPlxcdTA0MjJcXHUwNDMyXFx1MDQzRVxcdTA0MzggXFx1MDQzN1xcdTA0MzBcXHUwNDNBXFx1MDQzMFxcdTA0MzdcXHUwNDRCPC9oMj48dWwgY2xhc3M9b3JkZXJzLWxpc3Q+PGxpIGRhdGEtbmctcmVwZWF0PVxcJ29yZGVyIGluIG9yZGVycyB8IGZpbHRlcjogb3JkZXIuaWQgfCBvcmRlckJ5OiBcImlkXCJcXCc+XFx1MjExNiB7eyBvcmRlci5pZCB9fS4gPHNwYW4+e3sgb3JkZXIudGl0bGUgfX08L3NwYW4+IC0ge3sgb3JkZXIucXVhbnRpdHkgfX0gcGMgKHt7IG9yZGVyLmNvc3Qqb3JkZXIucXVhbnRpdHl9fSAkKTxidXR0b24gY2xhc3M9XCJidG4gYnRuLWRhbmdlclwiIGRhdGEtbmctY2xpY2s9cmVtb3ZlT3JkZXIoJGluZGV4KT5cXHUwNDIzXFx1MDQzNFxcdTA0MzBcXHUwNDNCXFx1MDQzOFxcdTA0NDJcXHUwNDRDPC9idXR0b24+PC9saT48L3VsPjxkaXYgY2xhc3M9c3VtPjxzcGFuPlxcdTA0MUVcXHUwNDMxXFx1MDQ0OVxcdTA0MzBcXHUwNDRGIFxcdTA0NDFcXHUwNDQzXFx1MDQzQ1xcdTA0M0NcXHUwNDMwOjwvc3Bhbj4gPHNwYW4gY2xhc3M9c3VtSW5mbz57eyBzdW0gfX0gJDwvc3Bhbj48L2Rpdj48YSBocmVmPVwiL1wiIGNsYXNzPVwiYnRuIGJ0bi1wcmltYXJ5IGJ0bi1sZ1wiPlxcdTA0MURcXHUwNDMwIFxcdTA0MzNcXHUwNDNCXFx1MDQzMFxcdTA0MzJcXHUwNDNEXFx1MDQ0M1xcdTA0NEU8L2E+PC9kaXY+Jyk7XG4kdGVtcGxhdGVDYWNoZS5wdXQoJy4uL3BhcnRpYWxzL3Byb2R1Y3QuaHRtbCcsJzxkaXYgY2xhc3M9e3twYWdlU3R5bGV9fT48bWQtdG9vbGJhciBjbGFzcz1tZC13YXJuPjxhIGhyZWY9I29yZGVycyBjbGFzcz1cImJ0biBidG4tcHJpbWFyeSBidG4tbGcgYnV5XCIgZGF0YS1uZy1jbGljaz1hZGRPcmRlcihpdGVtKT5cXHUwNDFBXFx1MDQ0M1xcdTA0M0ZcXHUwNDM4XFx1MDQ0MlxcdTA0NEMgXFx1MDQzMlxcdTA0NDFcXHUwNDM1XFx1MDQzM1xcdTA0M0UgXFx1MDQzN1xcdTA0MzAgJCB7eyBjb3N0IH19PC9hPjwvbWQtdG9vbGJhcj48bWQtY29udGVudCBmbGV4IGxheW91dC1wYWRkaW5nPjxoMT57eyB0aXRsZX19PC9oMT48aW1nIGNsYXNzPWltZy1yZXNwb25zaXZlIHNyYz1cInt7IGltZyB9fVwiIGFsdD1pbWcgd2lkdGg9MzAwPjxwIGNsYXNzPWRlc2M+e3sgZGVzY3JpcHRpb24gfX08L3A+PHA+PGI+XFx1MDQxNlxcdTA0MzBcXHUwNDNEXFx1MDQ0MDogPHNwYW4+e3tnZW5yZX19PC9zcGFuPjwvYj48L3A+PC9tZC1jb250ZW50PjxhIGhyZWY9L29yZGVycyBuZy1jbGljaz1kZWxldGVQcm9kdWN0KCkgY2xhc3M9XCJidG4gYnRuLXdhcm5pbmdcIj5cXHUwNDIzXFx1MDQzNFxcdTA0MzBcXHUwNDNCXFx1MDQzOFxcdTA0NDJcXHUwNDRDIFxcdTA0M0FcXHUwNDNEXFx1MDQzOFxcdTA0MzNcXHUwNDQzPC9hPiA8YSBocmVmPVwiL1wiIGNsYXNzPVwiYnRuIGJ0bi1pbmZvXCI+XFx1MDQxRFxcdTA0MzAgXFx1MDQzM1xcdTA0M0JcXHUwNDMwXFx1MDQzMlxcdTA0M0RcXHUwNDQzXFx1MDQ0RTwvYT48L2Rpdj4nKTt9XSk7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgc2hvcEFwcC5mYWN0b3J5KFwib3JkZXJzRmFjdG9yeVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBvcmRlcnMgPSBbe1xuICAgICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgICB0aXRsZTogXCJDYXQgaW4gdGhlIGRhcmtcIixcbiAgICAgICAgICAgIGltZzogJy4vaW1nL2NhdDIuanBnJyxcbiAgICAgICAgICAgIGRlc2M6IFwiSXRzIGp1c3QgbWVcIixcbiAgICAgICAgICAgIGNvc3Q6ICc1MCcsXG4gICAgICAgICAgICBxdWFudGl0eTogMVxuICAgICAgICB9XTtcbiAgICAgICAgdmFyIGZhY3RvcnkgPSB7fTtcbiAgICAgICAgZmFjdG9yeS5nZXRPcmRlcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gb3JkZXJzO1xuICAgICAgICB9O1xuXG4gICAgICAgIGZhY3RvcnkuYWRkT3JkZXIgPSBmdW5jdGlvbiAoaXRlbSkge1xuXG4gICAgICAgICAgICBpZiAob3JkZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgaXNDb2luY2lkZW5jZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIG9yZGVycy5mb3JFYWNoKGZ1bmN0aW9uIChvcmRlcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50aXRsZSA9PT0gb3JkZXIudGl0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ29pbmNpZGVuY2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXIucXVhbnRpdHkrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICghaXNDb2luY2lkZW5jZSkge1xuICAgICAgICAgICAgICAgICAgICBvcmRlcnMucHVzaChpdGVtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGZhY3RvcnkuZGVmaW5lQ29zdEZvckl0ZW1zID0gZnVuY3Rpb24gKG9yZGVycykge1xuICAgICAgICAgICAgdmFyIHN1bSA9IDA7XG4gICAgICAgICAgICBvcmRlcnMuZm9yRWFjaChmdW5jdGlvbiAob3JkZXIpIHtcbiAgICAgICAgICAgICAgICBzdW0gKz0gK29yZGVyLmNvc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBzdW07XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBmYWN0b3J5O1xuICAgIH0pO1xufSkoKTsiLCJcInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uICgpIHtcbiAgICAvLyBGQUNUT1JZXG4gICAgc2hvcEFwcC5mYWN0b3J5KFwicHJvZHVjdHNGYWN0b3J5XCIsIFtcIiRodHRwXCIsIFwiJGxvY2F0aW9uXCIsIGZ1bmN0aW9uICgkaHR0cCwgJGxvY2F0aW9uKSB7XG5cbiAgICAgICAgdmFyIHJlY2lldmVEYXRhID0gZnVuY3Rpb24gcmVjaWV2ZURhdGEoKSB7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCdodHRwOi8vbG9jYWxob3N0OjgwODAvJyk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBwcm9kdWN0cyA9IFtdO1xuXG4gICAgICAgIHZhciBmYWN0b3J5ID0ge307XG4gICAgICAgIGZhY3RvcnkuZ2V0SlNPTiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiByZWNpZXZlRGF0YSgpO1xuICAgICAgICB9O1xuICAgICAgICBmYWN0b3J5LmdldFByb2R1Y3RzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHByb2R1Y3RzO1xuICAgICAgICB9O1xuICAgICAgICBmYWN0b3J5LnNldFByb2R1Y3RzID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHByb2R1Y3RzID0gZGF0YTtcbiAgICAgICAgfTtcbiAgICAgICAgZmFjdG9yeS5hZGRQcm9kdWN0ID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICAgICAgICB1cmw6ICdodHRwOi8vbG9jYWxob3N0OjgwODAvJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShpdGVtKSxcbiAgICAgICAgICAgICAgICBjb25maWc6ICdDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2pzb247J1xuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBmYWN0b3J5LmRlbGV0ZVByb2R1Y3QgPSBmdW5jdGlvbiAoZGF0YSkge1xuXG4gICAgICAgICAgICB2YXIgcHJvZHVjdEluZm8gPSB7XG4gICAgICAgICAgICAgICAgaW5kZXg6IGRhdGEuaW5kZXgsXG4gICAgICAgICAgICAgICAgcHJvZHVjdElkOiBkYXRhLnByb2R1Y3QuaWRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAkaHR0cC5kZWxldGUoJ2h0dHA6Ly9sb2NhbGhvc3Q6ODA4MC9wcm9kdWN0LycgKyBwcm9kdWN0SW5mby5wcm9kdWN0SWQsIHsgcGFyYW1zOiBwcm9kdWN0SW5mbyB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBmYWN0b3J5LmZpbmRQcm9kdWN0QnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgdmFyIGZvdW5kID0gdm9pZCAwO1xuICAgICAgICAgICAgcHJvZHVjdHMuZm9yRWFjaChmdW5jdGlvbiAocHJvZHVjdCkge1xuICAgICAgICAgICAgICAgIGlmIChwcm9kdWN0LmlkID09IGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gcHJvZHVjdDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBmb3VuZDtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGZhY3Rvcnk7XG4gICAgfV0pO1xufSkoKTsiLCJcInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uICgpIHtcbiAgICBzaG9wQXBwLmNvbnRyb2xsZXIoXCJTaG93T3JkZXJzXCIsIFtcIiRzY29wZVwiLCBcIiRyb3V0ZVBhcmFtc1wiLCBcInByb2R1Y3RzRmFjdG9yeVwiLCBcIm9yZGVyc0ZhY3RvcnlcIiwgZnVuY3Rpb24gKCRzY29wZSwgJHJvdXRlUGFyYW1zLCBwcm9kdWN0c0ZhY3RvcnksIG9yZGVyc0ZhY3RvcnkpIHtcbiAgICAgICAgJHNjb3BlLnBhZ2VTdHlsZSA9ICdzaG93T3JkZXJzU3R5bGUnO1xuICAgICAgICAkc2NvcGUub3JkZXJzID0gW107XG4gICAgICAgICRzY29wZS5zdW0gPSBvcmRlcnNGYWN0b3J5LmRlZmluZUNvc3RGb3JJdGVtcyhvcmRlcnNGYWN0b3J5LmdldE9yZGVycygpKTtcbiAgICAgICAgJHNjb3BlLml0ZW0gPSB7fTtcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkID0geyB2YWx1ZTogMCB9O1xuXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgICRzY29wZS5vcmRlcnMgPSBvcmRlcnNGYWN0b3J5LmdldE9yZGVycygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXQoKTtcbiAgICAgICAgJHNjb3BlLnJlbW92ZU9yZGVyID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgIGlmICgkc2NvcGUub3JkZXJzW2l0ZW1dLnF1YW50aXR5ID4gMSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5vcmRlcnNbaXRlbV0ucXVhbnRpdHkgLT0gMTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoJHNjb3BlLm9yZGVyc1tpdGVtXS5xdWFudGl0eSA9PT0gMSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5vcmRlcnMuc3BsaWNlKGl0ZW0sIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1dKTtcbn0pKCk7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgc2hvcEFwcC5jb250cm9sbGVyKFwiU2hvd1Byb2R1Y3RcIiwgW1wiJHNjb3BlXCIsIFwiJHJvdXRlUGFyYW1zXCIsIFwicHJvZHVjdHNGYWN0b3J5XCIsIFwib3JkZXJzRmFjdG9yeVwiLCBmdW5jdGlvbiAoJHNjb3BlLCAkcm91dGVQYXJhbXMsIHByb2R1Y3RzRmFjdG9yeSwgb3JkZXJzRmFjdG9yeSkge1xuICAgICAgICAkc2NvcGUucGFnZVN0eWxlID0gJ3Nob3dQcm9kdWN0U3R5bGUnO1xuICAgICAgICAkc2NvcGUuUHJvZHVjdElkID0gJHJvdXRlUGFyYW1zLmlkO1xuICAgICAgICB2YXIgY3VycmVudFByb2R1Y3QgPSBwcm9kdWN0c0ZhY3RvcnkuZmluZFByb2R1Y3RCeUlkKCRzY29wZS5Qcm9kdWN0SWQpO1xuICAgICAgICAkc2NvcGUuaW1nID0gY3VycmVudFByb2R1Y3QuaW1nO1xuICAgICAgICAkc2NvcGUudGl0bGUgPSBjdXJyZW50UHJvZHVjdC50aXRsZTtcbiAgICAgICAgJHNjb3BlLmdlbnJlID0gY3VycmVudFByb2R1Y3QuZ2VucmU7XG4gICAgICAgICRzY29wZS5kZXNjcmlwdGlvbiA9IGN1cnJlbnRQcm9kdWN0LmRlc2NyaXB0aW9uO1xuICAgICAgICAkc2NvcGUuY29zdCA9IGN1cnJlbnRQcm9kdWN0LmNvc3Q7XG4gICAgICAgICRzY29wZS5wcm9kdWN0cyA9IHByb2R1Y3RzRmFjdG9yeS5nZXRQcm9kdWN0cygpO1xuXG4gICAgICAgICRzY29wZS5hZGRPcmRlciA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICBvcmRlcnNGYWN0b3J5LmFkZE9yZGVyKHtcbiAgICAgICAgICAgICAgICB0aXRsZTogY3VycmVudFByb2R1Y3QudGl0bGUsXG4gICAgICAgICAgICAgICAgaWQ6IG9yZGVyc0ZhY3RvcnkuZ2V0T3JkZXJzKCkubGVuZ3RoICsgMSxcbiAgICAgICAgICAgICAgICBjb3N0OiBjdXJyZW50UHJvZHVjdC5jb3N0LFxuICAgICAgICAgICAgICAgIHF1YW50aXR5OiAxXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuZGVsZXRlUHJvZHVjdCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgdmFyIGluZGV4ID0gJHNjb3BlLnByb2R1Y3RzLmluZGV4T2YoY3VycmVudFByb2R1Y3QpO1xuICAgICAgICAgICAgcHJvZHVjdHNGYWN0b3J5LmRlbGV0ZVByb2R1Y3Qoe1xuICAgICAgICAgICAgICAgIGluZGV4OiBpbmRleCxcbiAgICAgICAgICAgICAgICBwcm9kdWN0OiBjdXJyZW50UHJvZHVjdFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgfV0pO1xufSkoKTsiLCJcInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uICgpIHtcbiAgICBzaG9wQXBwLmNvbnRyb2xsZXIoXCJhZGRQcm9kdWN0XCIsIFtcIiRzY29wZVwiLCBcInByb2R1Y3RzRmFjdG9yeVwiLCBmdW5jdGlvbiAoJHNjb3BlLCBwcm9kdWN0c0ZhY3RvcnkpIHtcbiAgICAgICAgJHNjb3BlLnBhZ2VTdHlsZSA9ICdhZGRTdHlsZSc7XG5cbiAgICAgICAgJHNjb3BlLmFkZFByb2R1Y3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBwcm9kdWN0c0ZhY3RvcnkuYWRkUHJvZHVjdCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICRzY29wZS5uZXdQcm9kdWN0LnRpdGxlLFxuICAgICAgICAgICAgICAgIGltZzogJHNjb3BlLm5ld1Byb2R1Y3QuaW1nLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAkc2NvcGUubmV3UHJvZHVjdC5kZXNjLFxuICAgICAgICAgICAgICAgIGdlbnJlOiAkc2NvcGUubmV3UHJvZHVjdC5nZW5yZSxcbiAgICAgICAgICAgICAgICBjb3N0OiAkc2NvcGUubmV3UHJvZHVjdC5jb3N0LFxuICAgICAgICAgICAgICAgIGlkOiBNYXRoLnJhbmRvbSgpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9XSk7XG59KSgpOyIsIlwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgLy8gQ09OVFJPTExFUlMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBob21lIHBhZ2UgY29udHJvbGxlclxuICAgIHNob3BBcHAuY29udHJvbGxlcihcIm1haW5Db250cm9sbGVyXCIsIFtcIiRzY29wZVwiLCBcIiRsb2NhdGlvblwiLCBcIiRyb3V0ZVBhcmFtc1wiLCBcInByb2R1Y3RzRmFjdG9yeVwiLCBcIm9yZGVyc0ZhY3RvcnlcIiwgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCAkcm91dGVQYXJhbXMsIHByb2R1Y3RzRmFjdG9yeSwgb3JkZXJzRmFjdG9yeSkge1xuICAgICAgICAkc2NvcGUucGFnZVN0eWxlID0gJ21haW5QYWdlU3R5bGUnO1xuICAgICAgICAkc2NvcGUucGFnZUNsYXNzID0gXCJwYWdlLXN0eWxlXCI7XG4gICAgICAgICRzY29wZS5wcm9kdWN0cyA9IFtdO1xuICAgICAgICAkc2NvcGUub3JkZXJzID0gW107XG4gICAgICAgICRzY29wZS5pdGVtID0ge307XG5cbiAgICAgICAgdmFyIGNyZWF0ZUxpc3QgPSBmdW5jdGlvbiBjcmVhdGVMaXN0KCkge1xuICAgICAgICAgICAgcHJvZHVjdHNGYWN0b3J5LmdldEpTT04oKS50aGVuKGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICAgICAgICAgIHZhciBsaXN0ID0gW107XG4gICAgICAgICAgICAgICAgaXRlbXMuZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpc3RJdGVtID0ge307XG4gICAgICAgICAgICAgICAgICAgIGxpc3RJdGVtLmRlc2NyaXB0aW9uID0ga2V5LmRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgICAgICAgICBsaXN0SXRlbS50aXRsZSA9IGtleS50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgbGlzdEl0ZW0uaW1nID0ga2V5LmltZztcbiAgICAgICAgICAgICAgICAgICAgbGlzdEl0ZW0uZ2VucmUgPSBrZXkuZ2VucmU7XG4gICAgICAgICAgICAgICAgICAgIGxpc3RJdGVtLmNvc3QgPSBrZXkuY29zdDtcbiAgICAgICAgICAgICAgICAgICAgbGlzdEl0ZW0uaWQgPSBrZXkuaWQ7XG4gICAgICAgICAgICAgICAgICAgIGxpc3QucHVzaChsaXN0SXRlbSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcHJvZHVjdHNGYWN0b3J5LnNldFByb2R1Y3RzKGxpc3QpO1xuICAgICAgICAgICAgICAgICRzY29wZS5wcm9kdWN0cyA9IGxpc3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgICAkc2NvcGUucHJvZHVjdHMgPSBjcmVhdGVMaXN0KCk7XG4gICAgICAgICAgICAkc2NvcGUub3JkZXJzID0gb3JkZXJzRmFjdG9yeS5nZXRPcmRlcnMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0KCk7XG4gICAgfV0pO1xufSkoKTsiXX0=
